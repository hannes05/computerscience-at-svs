<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Social Media Assessment | Computer Science @ SVS</title>
  <script src="https://cdn.tailwindcss.com"></script><script src="https://unpkg.com/feather-icons"></script>
  <style>
    body{background:radial-gradient(circle at top,#0f172a 0%,#020617 100%);color:#e6eef8;font-family:Inter,system-ui}
    .content-box{background:rgba(7,10,22,0.65);border:1px solid #273449;border-radius:12px;padding:1.25rem}
    .draggable{cursor:grab;padding:.35rem .75rem;border-radius:8px;background:#0b1220;border:1px solid #263241;display:inline-block}
    .layer-target{min-height:56px;border:2px dashed rgba(100,116,139,0.18);border-radius:8px;padding:.5rem;display:flex;align-items:center;justify-content:center;flex-wrap:wrap;gap:6px}
    .tile{padding:.25rem .6rem;border-radius:6px;background:#142033;color:#dbeafe;border:1px solid #213246}
    @media print{header,footer,.hidden-print{display:none!important}.content-box{background:transparent!important;border:none!important;box-shadow:none!important}}
  /* Tap selection highlight */
.draggable-word.selected {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
  background-color: rgba(59,130,246,0.2);
}

  </style>
</head>
<body class="min-h-screen antialiased">

  <!-- header -->
  <header class="sticky top-0 z-40 bg-transparent">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a href="index.html" class="text-yellow-400 inline-flex items-center"><i data-feather="home" class="w-5 h-5 mr-2"></i>Main</a>
        <a href="socialmedia.html" class="text-blue-300 inline-flex items-center"><i data-feather="chevron-left" class="w-5 h-5 mr-2"></i>Back</a>
      </div>
      <h1 class="text-yellow-400 font-extrabold text-lg">Social Media Assessment</h1>
      <div class="text-sm text-gray-300">KS3 • Year 7</div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-6 space-y-6">

    <!-- instructions -->
    <section class="content-box">
      <div class="flex gap-4">
        <i data-feather="info" class="w-7 h-7 text-blue-400"></i>
        <div>
          <h2 class="text-lg font-semibold text-blue-300">Instructions</h2>
          <p class="text-gray-300 mt-1">Complete all activities. Auto-marked sections will be scored immediately. Save your results, print them, and submit to your teacher.</p>
          <div class="mt-2">
            <label class="text-sm text-gray-300">Your name (for print/export):</label>
            <input id="studentName" class="mt-1 px-3 py-2 rounded bg-gray-900 text-white" placeholder="Type full name...">
            <input id="studentClass" class="mt-1 ml-3 px-3 py-2 rounded bg-gray-900 text-white" placeholder="Class (e.g. 7B)">
          </div>
        </div>
      </div>
    </section>

    <!-- Matching scenarios -->
    <section class="content-box">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-semibold text-blue-300">Case scenarios — Match the correct solution</h3>
        <p class="text-sm text-gray-400">Drag the right action onto the scenario (or click to match).</p>
      </div>

      <div class="grid lg:grid-cols-2 gap-6">
        <div>
          <div class="mb-3">
            <div class="p-3 bg-gray-800 rounded"><strong>1.</strong> Someone you don't know asks for your address in a message.</div>
            <div class="p-3 bg-gray-800 rounded mt-2"><strong>2.</strong> A friend shares a photo of you that makes you uncomfortable.</div>
            <div class="p-3 bg-gray-800 rounded mt-2"><strong>3.</strong> You see a mean comment about someone in your class.</div>
            <div class="p-3 bg-gray-800 rounded mt-2"><strong>4.</strong> An account pretends to be a celebrity and asks for money.</div>
            <div class="p-3 bg-gray-800 rounded mt-2"><strong>5.</strong> You get a link in a message that looks suspicious.</div>
            <div class="p-3 bg-gray-800 rounded mt-2"><strong>6.</strong> You see a post asking people to share their school timetable publicly.</div>
          </div>
        </div>

        <div>
          <p class="text-sm text-gray-300">Actions — drag these to the matching scenario:</p>
          <div id="actionsPool" class="mt-2 flex flex-wrap gap-2">
            <div class="draggable" draggable="true" data-key="block-report">Block & report the user</div>
            <div class="draggable" draggable="true" data-key="tell-adult">Tell a trusted adult</div>
            <div class="draggable" draggable="true" data-key="ask-to-remove">Ask them to remove the photo</div>
            <div class="draggable" draggable="true" data-key="ignore-delete">Ignore and delete the message</div>
            <div class="draggable" draggable="true" data-key="do-not-click">Do not click the link</div>
            <div class="draggable" draggable="true" data-key="privacy-check">Do not share personal info / check privacy</div>
          </div>

          <div class="mt-4 space-y-2">
            <div class="p-3 bg-gray-900 rounded">
              <label class="block text-xs text-gray-400">Drop for scenario 1</label>
              <div id="match-1" class="layer-target" data-accept="privacy-check|block-report|ignore-delete|do-not-click|tell-adult|ask-to-remove"></div>
            </div>

            <div class="p-3 bg-gray-900 rounded mt-2">
              <label class="block text-xs text-gray-400">Drop for scenario 2</label>
              <div id="match-2" class="layer-target" data-accept="ask-to-remove|tell-adult|block-report"></div>
            </div>

            <div class="p-3 bg-gray-900 rounded mt-2">
              <label class="block text-xs text-gray-400">Drop for scenario 3</label>
              <div id="match-3" class="layer-target" data-accept="tell-adult|block-report|ignore-delete"></div>
            </div>

            <div class="p-3 bg-gray-900 rounded mt-2">
              <label class="block text-xs text-gray-400">Drop for scenario 4</label>
              <div id="match-4" class="layer-target" data-accept="block-report|ignore-delete|tell-adult"></div>
            </div>

            <div class="p-3 bg-gray-900 rounded mt-2">
              <label class="block text-xs text-gray-400">Drop for scenario 5</label>
              <div id="match-5" class="layer-target" data-accept="do-not-click|block-report|ignore-delete"></div>
            </div>

            <div class="p-3 bg-gray-900 rounded mt-2">
              <label class="block text-xs text-gray-400">Drop for scenario 6</label>
              <div id="match-6" class="layer-target" data-accept="privacy-check|tell-adult|block-report"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Diagram (simple relationships) -->
    <section class="content-box">
      <h3 class="text-lg font-semibold text-blue-300">Diagram — Content flow (drag labels)</h3>
      <div class="grid lg:grid-cols-3 gap-4 mt-3">
        <div class="p-3 bg-gray-900 rounded">
          <p class="text-sm text-gray-300">Labels</p>
          <div id="diagramPool" class="mt-2 flex flex-wrap gap-2">
            <div class="draggable" draggable="true" data-key="post">Post</div>
            <div class="draggable" draggable="true" data-key="viewer">Viewer</div>
            <div class="draggable" draggable="true" data-key="platform">Platform</div>
            <div class="draggable" draggable="true" data-key="report">Report</div>
          </div>
        </div>

        <div class="lg:col-span-2 p-3 bg-gray-900 rounded">
          <div class="mb-2">Drop labels into the correct boxes</div>
          <div class="grid sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-xs text-gray-400">Source</label>
              <div id="target-source" class="layer-target" data-accept="post"></div>
            </div>
            <div>
              <label class="block text-xs text-gray-400">Receiver</label>
              <div id="target-receiver" class="layer-target" data-accept="viewer"></div>
            </div>
            <div>
              <label class="block text-xs text-gray-400">Platform</label>
              <div id="target-platform" class="layer-target" data-accept="platform"></div>
            </div>
            <div>
              <label class="block text-xs text-gray-400">Action</label>
              <div id="target-action" class="layer-target" data-accept="report"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Multiple choice (10) -->
    <section class="content-box">
      <h3 class="text-lg font-semibold text-blue-300">Multiple Choice (10)</h3>
      <div class="mt-3 space-y-3 text-sm">
        <!-- Q1 -->
        <div class="p-3 bg-gray-800 rounded">
          <p>1. If someone you don't know sends a friend request, you should:</p>
          <label><input name="m1" type="radio" value="a"> A) Accept immediately</label><br>
          <label><input name="m1" type="radio" value="b"> B) Ignore and do nothing</label><br>
          <label><input name="m1" type="radio" value="c"> C) Check their profile and only accept if trusted</label><br>
          <label><input name="m1" type="radio" value="d"> D) Share personal details</label>
        </div>

        <!-- Q2 -->
        <div class="p-3 bg-gray-800 rounded">
          <p>2. Which is the best way to protect privacy?</p>
          <label><input name="m2" type="radio" value="a"> A) Use private account settings</label><br>
          <label><input name="m2" type="radio" value="b"> B) Share passwords with friends</label><br>
          <label><input name="m2" type="radio" value="c"> C) Post your location publicly</label><br>
          <label><input name="m2" type="radio" value="d"> D) Use same password everywhere</label>
        </div>

        <!-- Q3 -->
        <div class="p-3 bg-gray-800 rounded">
          <p>3. If someone posts untrue rumours about a classmate you should:</p>
          <label><input name="m3" type="radio" value="a"> A) Share it so others see</label><br>
          <label><input name="m3" type="radio" value="b"> B) Laugh and ignore</label><br>
          <label><input name="m3" type="radio" value="c"> C) Report the post and tell an adult</label><br>
          <label><input name="m3" type="radio" value="d"> D) Join in</label>
        </div>

        <!-- Q4 -->
        <div class="p-3 bg-gray-800 rounded">
          <p>4. A password should be:</p>
          <label><input name="m4" type="radio" value="a"> A) Easy to guess</label><br>
          <label><input name="m4" type="radio" value="b"> B) Shared with friends</label><br>
          <label><input name="m4" type="radio" value="c"> C) Strong and unique</label><br>
          <label><input name="m4" type="radio" value="d"> D) The same as your username</label>
        </div>

        <!-- Q5 -->
        <div class="p-3 bg-gray-800 rounded">
          <p>5. If you see upsetting content, you should:</p>
          <label><input name="m5" type="radio" value="a"> A) Keep watching</label><br>
          <label><input name="m5" type="radio" value="b"> B) Save it for later</label><br>
          <label><input name="m5" type="radio" value="c"> C) Close the app and tell an adult</label><br>
          <label><input name="m5" type="radio" value="d"> D) Share it with friends</label>
        </div>

        <!-- Q6 -->
        <div class="p-3 bg-gray-800 rounded">
          <p>6. What should you NOT post online?</p>
          <label><input name="m6" type="radio" value="a"> A) Personal address</label><br>
          <label><input name="m6" type="radio" value="b"> B) Favourite hobby</label><br>
          <label><input name="m6" type="radio" value="c"> C) School club times</label><br>
          <label><input name="m6" type="radio" value="d"> D) School mascot</label>
        </div>

        <!-- Q7 -->
        <div class="p-3 bg-gray-800 rounded">
          <p>7. Reporting a fake account is done to:</p>
          <label><input name="m7" type="radio" value="a"> A) Stop scammers and protect people</label><br>
          <label><input name="m7" type="radio" value="b"> B) Get more followers</label><br>
          <label><input name="m7" type="radio" value="c"> C) Delete your account</label><br>
          <label><input name="m7" type="radio" value="d"> D) Make posts go viral</label>
        </div>

        <!-- Q8 -->
        <div class="p-3 bg-gray-800 rounded">
          <p>8. Which is a good sign a profile might be fake?</p>
          <label><input name="m8" type="radio" value="a"> A) Lots of personal photos and friends</label><br>
          <label><input name="m8" type="radio" value="b"> B) No posts and very few friends</label><br>
          <label><input name="m8" type="radio" value="c"> C) Verified badge</label><br>
          <label><input name="m8" type="radio" value="d"> D) Posts from known friends</label>
        </div>

        <!-- Q9 -->
        <div class="p-3 bg-gray-800 rounded">
          <p>9. If someone asks for money online, you should:</p>
          <label><input name="m9" type="radio" value="a"> A) Send money if they promise it's urgent</label><br>
          <label><input name="m9" type="radio" value="b"> B) Ask to meet them first</label><br>
          <label><input name="m9" type="radio" value="c"> C) Ignore and tell an adult</label><br>
          <label><input name="m9" type="radio" value="d"> D) Post it publicly</label>
        </div>

        <!-- Q10 -->
        <div class="p-3 bg-gray-800 rounded">
          <p>10. Your digital footprint is:</p>
          <label><input name="m10" type="radio" value="a"> A) The marks you make in a game</label><br>
          <label><input name="m10" type="radio" value="b"> B) A record of what you post and do online</label><br>
          <label><input name="m10" type="radio" value="c"> C) Only what you delete</label><br>
          <label><input name="m10" type="radio" value="d"> D) Your passwords</label>
        </div>
      </div>
    </section>

    <!-- Fill in the blanks (5) -->
    <section class="content-box">
      <h3 class="text-lg font-semibold text-blue-300">Fill in the Missing Words (5)</h3>
      <div class="mt-3 space-y-2 text-sm">
        <label>1. Never share your <input id="fb1" class="ml-2 px-2 py-1 rounded bg-gray-900 text-white" placeholder="_____" /></label>
        <label>2. If you see bullying online, you should <input id="fb2" class="ml-2 px-2 py-1 rounded bg-gray-900 text-white" placeholder="_____" /></label>
        <label>3. Use <input id="fb3" class="ml-2 px-2 py-1 rounded bg-gray-900 text-white" placeholder="_____" /> accounts to limit who sees posts</label>
        <label>4. If a message asks for money, you should <input id="fb4" class="ml-2 px-2 py-1 rounded bg-gray-900 text-white" placeholder="_____" /></label>
        <label>5. When upset by content, <input id="fb5" class="ml-2 px-2 py-1 rounded bg-gray-900 text-white" placeholder="_____" /></label>
      </div>
    </section>

    <!-- Short written -->
    <section class="content-box">
      <h3 class="text-lg font-semibold text-blue-300">Short Written Answers</h3>
      <label class="block text-sm text-gray-200 mt-2">1. Describe what you would do if someone posted an embarrassing photo of you. (1–3 sentences)</label>
      <textarea id="sa1" class="w-full mt-2 bg-gray-900 px-3 py-2 rounded" rows="3"></textarea>

      <label class="block text-sm text-gray-200 mt-3">2. Explain why privacy settings are important (1–2 sentences)</label>
      <textarea id="sa2" class="w-full mt-2 bg-gray-900 px-3 py-2 rounded" rows="2"></textarea>
    </section>

    <!-- submit -->
    <section class="content-box" id="submitSection">
      <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
        <div>
          <button id="submitBtn" class="px-5 py-2 bg-green-600 hover:bg-green-700 rounded font-bold inline-flex items-center"><i data-feather="check" class="w-4 h-4 mr-2"></i> Submit Assessment</button>
          <button id="clearBtn" class="ml-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded">Clear Saved</button>
          <button id="printBtn" class="ml-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded"><i data-feather="printer" class="w-4 h-4 mr-2"></i> Print Results</button>
        </div>
        <div class="text-sm text-gray-300">Auto-marked: Matching, MCQ, Diagram, Fill-ins</div>
      </div>

      <div id="results" class="mt-4 hidden">
        <h4 class="text-lg text-blue-300 font-semibold">Results & Feedback</h4>
        <div id="summary" class="mt-2 p-3 bg-gray-900 rounded border border-gray-700"></div>
        <div class="mt-3 grid sm:grid-cols-2 gap-3">
          <div class="p-3 bg-gray-900 rounded border border-gray-700">
            <h5 class="font-semibold text-yellow-300">Question breakdown</h5>
            <ul id="breakdown" class="mt-2 text-sm"></ul>
          </div>
          <div class="p-3 bg-gray-900 rounded border border-gray-700">
            <h5 class="font-semibold text-yellow-300">Matching & Diagram</h5>
            <div id="matchFB" class="mt-2 text-sm"></div>
          </div>
        </div>

        <div class="mt-3 p-3 bg-gray-900 rounded border border-gray-700">
          <h5 class="font-semibold text-yellow-300">Your written answers (for teacher)</h5>
          <div id="writtenFB" class="mt-2 text-sm"></div>
        </div>

        <div class="mt-3 p-3 bg-blue-900/20 rounded border border-blue-800 text-sm">
          <strong class="text-yellow-300">Reminder:</strong> Take a screenshot or click Print Results and submit to your teacher as evidence.
        </div>
      </div>
    </section>

  </main>

  <footer class="text-center text-sm text-gray-400 p-6">© 2025 Computer Science @ SVS</footer>
  <a href="index.html" class="fixed bottom-6 right-6 p-3 rounded-full bg-blue-600 text-white z-50"><i data-feather="home" class="w-5 h-5"></i></a>

  <script>feather.replace()</script>

  <script>
    // -- Utility
    const norm = s => (s||'').toString().trim().toLowerCase();

    // --- Section 1: Tap-to-Select + Place Logic (Desktop + Mobile Friendly) ---
let selectedWord = null;

// When a draggable word is tapped or clicked
document.querySelectorAll('.draggable-word').forEach(word => {
  word.addEventListener('click', () => {
    // Toggle selection state
    if (selectedWord === word) {
      word.classList.remove('selected');
      selectedWord = null;
      return;
    }

    // Remove previous selection
    document.querySelectorAll('.draggable-word').forEach(w => w.classList.remove('selected'));
    selectedWord = word;
    word.classList.add('selected');
  });
});

// When a blank is tapped/clicked
document.querySelectorAll('.blank-drop').forEach(blank => {
  blank.addEventListener('click', () => {
    if (!selectedWord) return;

    // Allow overwriting an existing answer
    if (blank.dataset.currentWord) {
      const previousWord = Array.from(document.querySelectorAll('.draggable-word'))
        .find(w => w.textContent.trim() === blank.dataset.currentWord);
      if (previousWord) previousWord.classList.remove('hidden');
    }

    blank.textContent = selectedWord.textContent;
    blank.dataset.currentWord = selectedWord.textContent;
    blank.classList.add('bg-blue-900', 'text-white');
    blank.classList.remove('bg-gray-700');

    selectedWord.classList.remove('selected');
    selectedWord.classList.add('hidden'); // hide placed word
    selectedWord = null;
  });
});

          // remove duplicate tiles
          document.querySelectorAll('[data-key="'+key+'"]').forEach(el => {
            // keep pool original if it is in pool
            if(el.parentElement && el.parentElement.id && el.parentElement.id==='actionsPool') return;
            if(el.parentElement && el.parentElement.classList && el.parentElement.classList.contains('layer-target')) el.remove();
          });
          const tile = document.createElement('div');
          tile.className = 'tile';
          tile.textContent = key;
          tile.setAttribute('data-key', key);
          tile.addEventListener('click', ()=> tile.remove());
          t.appendChild(tile);
        });
      });
    }

    makeDraggables('.draggable');
    makeTargets('.layer-target');

    // -- MCQ correct answers
    const mcqAnswers = {
      m1: 'c', m2: 'a', m3: 'c', m4: 'c', m5: 'c',
      m6: 'a', m7: 'a', m8: 'b', m9: 'c', m10: 'b'
    };

    // -- fill-in correct answers (simple)
    const fillAnswers = {
      fb1: ['password','personal details','personal information','address','phone number'],
      fb2: ['report it','tell an adult','tell a trusted adult','report'],
      fb3: ['private','private account','private settings'],
      fb4: ['tell an adult','ignore and tell an adult','tell an adult/ignore'],
      fb5: ['close the app','tell an adult','tell someone','stop watching']
    };

    function checkFill(id, val) {
      const v = norm(val);
      if(!fillAnswers[id]) return false;
      return fillAnswers[id].some(ans => norm(ans) === v);
    }

    // -- submit logic
    document.getElementById('submitBtn').addEventListener('click', ()=> {
      // MCQs
      let mcqTotal = Object.keys(mcqAnswers).length, mcqCorrect = 0;
      const mcqDetails = [];
      for(const q in mcqAnswers){
        const sel = document.querySelector('input[name="'+q+'"]:checked');
        const chosen = sel ? sel.value : null;
        const ok = chosen === mcqAnswers[q];
        if(ok) mcqCorrect++;
        mcqDetails.push({q,chosen,ok});
      }

      // fill-ins
      let fillTotal = 5, fillCorrect = 0; const fillDetails = [];
      for(let i=1;i<=5;i++){
        const id = 'fb'+i; const val = document.getElementById(id).value||'';
        const ok = checkFill(id,val);
        if(ok) fillCorrect++;
        fillDetails.push({id,answer:val,ok});
      }

      // matching scenarios (6)
      const matchCorrect = [];
      const matchFeedback = [];
      const expected = {
        'match-1':'privacy-check',
        'match-2':'ask-to-remove',
        'match-3':'tell-adult',
        'match-4':'block-report',
        'match-5':'do-not-click',
        'match-6':'privacy-check'
      };
      let matchScore = 0, matchTotal = 6;
      for(let i=1;i<=6;i++){
        const t = document.getElementById('match-'+i);
        const tile = t.querySelector('[data-key]');
        const chosen = tile ? tile.getAttribute('data-key') : null;
        const ok = chosen === expected['match-'+i];
        if(ok) matchScore++;
        matchFeedback.push({scenario:i,chosen,ok});
      }

      // diagram: check each target
      let diagramScore=0, diagramTotal=4; const diagFeedback = [];
      const chk = (id,key,msg) => {
        const t = document.getElementById(id);
        const ok = Array.from(t.querySelectorAll('[data-key]')).some(n=>n.getAttribute('data-key')===key);
        if(ok) {diagramScore++; diagFeedback.push({ok:true,msg});}
        else {diagFeedback.push({ok:false,msg});}
      };
      chk('target-source','post','Source should contain Post');
      chk('target-receiver','viewer','Receiver should contain Viewer');
      chk('target-platform','platform','Platform should be Platform');
      chk('target-action','report','Action should be Report');

      // totals
      const autoCorrect = mcqCorrect + fillCorrect + matchScore + diagramScore;
      const autoTotal = mcqTotal + fillTotal + matchTotal + diagramTotal;

      // written answers
      const wa1 = document.getElementById('sa1').value.trim();
      const wa2 = document.getElementById('sa2').value.trim();

      // build results object with best-score logic
      const now = new Date().toLocaleString();
      const results = {
        date: now,
        name: document.getElementById('studentName').value || '',
        class: document.getElementById('studentClass').value || '',
        mcqTotal, mcqCorrect, mcqDetails,
        fillTotal, fillCorrect, fillDetails,
        matchTotal, matchScore, matchFeedback,
        diagramTotal, diagramScore, diagFeedback,
        autoTotal, autoCorrect,
        wa1, wa2
      };

      // load existing best
      let saved = null;
      try { saved = JSON.parse(localStorage.getItem('socialMediaResults')); } catch(e){}
      if(!saved) saved = {bestScore:0,attempts:0,bestDate:null};
      saved.attempts = (saved.attempts || 0) + 1;
      if(autoCorrect > (saved.bestScore || 0)) { saved.bestScore = autoCorrect; saved.bestDate = now; }
      // store last results + best meta
      const store = {meta:saved, last:results};
      localStorage.setItem('socialMediaResults', JSON.stringify(store));

      // display results
      showResults(store);

      // show toast instruction
      showToast('Assessment submitted. Take a screenshot or print results and send to your teacher.');
    });

    // show results function
    function showResults(store) {
      const out = store.last;
      document.getElementById('summary').innerHTML = `<div><strong>Score (auto):</strong> ${out.autoCorrect}/${out.autoTotal}</div>
        <div><strong>Best score:</strong> ${store.meta.bestScore}/${out.autoTotal} (${store.meta.bestDate || '—'})</div>
        <div><strong>Attempts:</strong> ${store.meta.attempts}</div>
        <div><strong>Saved:</strong> ${out.date}</div>`;
      // breakdown
      const bd = document.getElementById('breakdown'); bd.innerHTML='';
      out.mcqDetails.forEach((d,i)=> {
        const li = document.createElement('li');
        li.innerHTML = `<strong>Q${i+1}:</strong> ${d.ok ? '<span class="text-green-400">Correct</span>':'<span class="text-red-400">Wrong</span>'} — Answer: ${d.chosen||'<em>none</em>'}`;
        bd.appendChild(li);
      });
      out.fillDetails.forEach((f,i)=>{
        const li = document.createElement('li');
        li.innerHTML = `<strong>F${i+1}:</strong> ${f.ok?'<span class="text-green-400">Correct</span>':'<span class="text-red-400">Wrong</span>'} — "${f.answer}"`;
        bd.appendChild(li);
      });
      // matching
      const mb = document.getElementById('matchFB'); mb.innerHTML='';
      out.matchFeedback.forEach(m=>{
        const div = document.createElement('div');
        div.innerHTML = `<div class="${m.ok?'text-green-300':'text-red-300'}">Scenario ${m.scenario}: ${m.ok? 'Correct':'Incorrect'} ${m.chosen?(' — chosen: '+m.chosen):''}</div>`;
        mb.appendChild(div);
      });
      // diagram feedback
      out.diagFeedback = out.diagFeedback || []; // ensure
      out.diagFeedback = out.diagFeedback.length?out.diagFeedback:out.diagFeedback;
      out.diagFeedback = out.diagFeedback;
      out.diagFeedback = out.diagFeedback;
      // show diag feedback from function diagFeedback created earlier
      // we built diagFeedback earlier as array in local variable; but safe to show diagFeedback computed earlier
      // we will use stored last.diagFeedback if exists else use global diagFeedback computed
      const diagArea = document.getElementById('matchFB');
      // add diagram feedback from stored last if present:
      if(out.diagFeedback && out.diagFeedback.length){
        out.diagFeedback.forEach(d=>{
          const el = document.createElement('div'); el.className = d.ok?'text-green-300':'text-red-300'; el.innerHTML = '• '+d.msg; mb.appendChild(el);
        });
      } else {
        // fallback: nothing
      }
      // written answers
      const wfb = document.getElementById('writtenFB'); wfb.innerHTML = `<div><strong>1.</strong> ${out.wa1||'<em>none</em>'}</div><div class="mt-2"><strong>2.</strong> ${out.wa2||'<em>none</em>'}</div>`;
      document.getElementById('results').classList.remove('hidden');
      document.getElementById('results').scrollIntoView({behavior:'smooth'});
    }


    // clear saved
    document.getElementById('clearBtn').addEventListener('click', ()=>{
      localStorage.removeItem('socialMediaResults');
      showToast('Saved results cleared.');
      document.getElementById('results').classList.add('hidden');
    });

    // print
    document.getElementById('printBtn').addEventListener('click', ()=> window.print());

    // load saved on open
    window.addEventListener('DOMContentLoaded', ()=>{
      try {
        const raw = localStorage.getItem('socialMediaResults');
        if(raw){ const store = JSON.parse(raw); if(store.last) showResults(store); }
      } catch(e){}
    });

    // simple toast
    function showToast(msg, ms=3500){
      const t = document.createElement('div'); t.className='fixed left-1/2 -translate-x-1/2 bottom-6 z-60 bg-blue-700 text-white px-4 py-3 rounded shadow-lg'; t.textContent=msg; document.body.appendChild(t);
      setTimeout(()=> t.remove(), ms);
    }

    // reinitialize draggables and targets for dynamic elements (call after DOM ready)
    (function initDrag(){
      document.querySelectorAll('.draggable').forEach(d=>{
        d.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text/plain', d.dataset.key);
          setTimeout(()=> d.style.visibility='hidden', 0);
        });
        d.addEventListener('dragend', e => d.style.visibility='visible');
      });
      document.querySelectorAll('.layer-target').forEach(t=>{
        t.addEventListener('dragover', e=> e.preventDefault());
        t.addEventListener('drop', e=>{
          e.preventDefault();
          const key = e.dataTransfer.getData('text/plain');
          if(!key) return;
          document.querySelectorAll('[data-key="'+key+'"]').forEach(el=>{
            if(el.parentElement && el.parentElement.id && el.parentElement.id==='actionsPool') return;
            if(el.parentElement && el.parentElement.classList && el.parentElement.classList.contains('layer-target')) el.remove();
          });
          const tile = document.createElement('div'); tile.className='tile'; tile.textContent=key; tile.setAttribute('data-key',key); tile.addEventListener('click', ()=> tile.remove()); t.appendChild(tile);
        });
      });
    })();

  </script>
</body>
</html>

