<!doctype html>
<html lang="en">
<head>
  <link rel="icon" href="fox_favicon.png" type="image/png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Social Media Awareness Assessment</title>

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Feather icons -->
  <script src="https://unpkg.com/feather-icons"></script>

  <style>
    /* ---------- Palette & base ---------- */
    :root{
      --primary: #5B8DEF;
      --primary-100: #C9E8FF;
      --bg-start: #F8FBFF;
      --bg-end: #E8F1FF;
      --card: #FFFFFF;
      --text: #2E2E2E;
      --muted: #6A6A6A;
      --success: #38C172;
      --warn: #FFA500;
      --danger: #E3342F;
      --glass: rgba(91,141,239,0.06);
      --shadow: 0 8px 30px rgba(46,46,46,0.08);
      --radius: 12px;
      --fab-size: 56px;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Poppins", Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(180deg,var(--bg-start) 0%, var(--bg-end) 100%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.55;
      padding-bottom:110px;
    }

    /* ---------- layout ---------- */
    .wrap{max-width:1050px;margin:24px auto;padding:20px}
    header.site{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      margin-bottom:18px;
    }
    header .title{
      display:flex;flex-direction:column;align-items:flex-start;
    }
    header h1{font-size: clamp(18px, 2.6vw, 28px); margin:0; color:var(--primary); font-weight:700}
    header p{margin:6px 0 0;color:var(--muted);font-size:0.95rem}

    /* ---------- card ---------- */
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      border:1px solid rgba(14,47,99,0.06);
      margin-bottom:14px;
    }
    .muted { color: var(--muted); font-size:0.95rem; }

    /* ---------- instructions ---------- */
    .instructions { display:flex; gap:12px; align-items:flex-start; }
    .badge { background:var(--primary-100); color:var(--primary); font-weight:600; padding:6px 10px; border-radius:999px; font-size:0.85rem; }

    /* ---------- accordion (sections) ---------- */
    .accordion{margin-top:10px}
    .acc-item{border-radius:10px; overflow:hidden; border:1px solid rgba(14,47,99,0.04); margin-bottom:10px;}
    .acc-head{
      display:flex;align-items:center;justify-content:space-between;padding:12px 14px;background:linear-gradient(90deg,#fff,#f7fbff);
      cursor:pointer; gap:12px; transition: background 0.2s ease;
    }
    .acc-head:hover{background:linear-gradient(90deg,#f7fbff,#eef6ff)}
    .acc-head.active{background:linear-gradient(90deg,#eef6ff,#e6f2ff)}
    .acc-head h3{margin:0;font-size:1rem;color:var(--text)}
    .acc-head .meta { color:var(--muted); font-size:0.9rem }
    .acc-head .toggle-icon{transition: transform 0.3s ease; color:var(--primary)}
    .acc-head.active .toggle-icon{transform: rotate(180deg)}
    .acc-body{
      padding:0 14px;
      max-height:0;
      overflow:hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
      border-top:1px solid transparent;
    }
    .acc-body.show{
      padding:14px;
      max-height:2000px;
      border-top:1px solid rgba(14,47,99,0.04);
    }

    /* ---------- questions ---------- */
    .question{background:#f6fbff;padding:12px;border-radius:8px;border:1px solid rgba(14,47,99,0.03); margin-bottom:10px;}
    .q-title{font-weight:600;margin-bottom:8px;color:var(--text)}
    .choices label{display:block; margin-bottom:6px; cursor:pointer; color:var(--text)}
    input[type="radio"]{margin-right:8px}

    input[type="text"], textarea, input[type="search"]{
      width:100%; padding:10px;border-radius:8px;border:1px solid rgba(14,47,99,0.06); background: #ffffff; color:var(--text);
    }

    textarea{min-height:72px; resize:vertical}

    /* ---------- buttons ---------- */
    .btn{
      display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:none;cursor:pointer;
      font-weight:700; font-size:0.95rem; box-shadow: 0 6px 20px rgba(91,141,239,0.08);
      transition: transform .12s ease, box-shadow .12s ease;
      background:linear-gradient(180deg,var(--primary), #3f74d8); color:white;
    }
    .btn:focus{outline:3px solid rgba(91,141,239,0.18); outline-offset:2px}
    .btn:hover{ box-shadow: 0 10px 30px rgba(91,141,239,0.16); transform: translateY(-2px) }
    .btn:active{ transform: translateY(0); box-shadow: 0 6px 16px rgba(91,141,239,0.09) }
    .btn.ghost{ background:transparent; color:var(--primary); border:1px solid rgba(91,141,239,0.12); font-weight:600; box-shadow:none }
    .btn.red{ background: linear-gradient(180deg,#ff6b6b,#ef4b4b) }
    .btn.blue{ background: linear-gradient(180deg,#3b82f6,#2563eb) }
    .btn.green{ background: linear-gradient(180deg,#34d399,#10b981) }

    /* small helpers */
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:160px}
    .hint{color:var(--muted);font-size:0.9rem}
    .divider{height:1px;background:linear-gradient(90deg, transparent, rgba(14,47,99,0.04), transparent); margin:12px 0}

    /* FIXED: results modal - now responsive and scrollable */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(24,29,63,0.45); 
      display:none; 
      align-items:center;
      justify-content:center; 
      z-index:1200; 
      padding:16px;
      overflow-y:auto;
    }
    .modal-backdrop.show{display:flex}
    
    .modal{
      background:var(--card); 
      width:100%; 
      max-width:650px;
      max-height:90vh;
      border-radius:14px;
      padding:20px; 
      box-shadow: 0 20px 60px rgba(20,30,60,0.18);
      border: 1px solid rgba(91,141,239,0.10);
      transform-origin:center center;
      margin:auto;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    
    .modal-header{
      flex-shrink:0;
      padding-bottom:12px;
      border-bottom:1px solid rgba(14,47,99,0.06);
    }
    
    .modal-content{
      flex:1;
      overflow-y:auto;
      padding-top:12px;
      margin-right:-8px;
      padding-right:8px;
    }
    
    .modal-content::-webkit-scrollbar{
      width:8px;
    }
    .modal-content::-webkit-scrollbar-track{
      background:rgba(91,141,239,0.04);
      border-radius:4px;
    }
    .modal-content::-webkit-scrollbar-thumb{
      background:rgba(91,141,239,0.2);
      border-radius:4px;
    }
    .modal-content::-webkit-scrollbar-thumb:hover{
      background:rgba(91,141,239,0.3);
    }
    
    .score-box{display:flex;align-items:center;gap:14px;flex-wrap:wrap}
    .score-pill{
      font-weight:800;
      font-size:1.3rem;
      padding:8px 14px;
      border-radius:10px;
      background:linear-gradient(90deg,var(--primary),#3f74d8);
      color:white;
      box-shadow:0 8px 30px rgba(91,141,239,0.18);
      white-space:nowrap;
    }
    .score-message{font-weight:700;color:var(--text);font-size:1.1rem}
    .section-breakdown{
      margin-top:12px;
      border-radius:8px;
      padding:10px;
      background:#f7fbff;
      border:1px solid rgba(91,141,239,0.04)
    }
    .section-line{
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      padding:8px 6px;
      border-radius:8px;
      flex-wrap:wrap;
    }
    .section-line .label{font-weight:600;font-size:0.95rem}
    .section-line .small{color:var(--muted);font-size:0.85rem;margin-top:2px}
    .feedback-good{color:var(--success);font-weight:700}
    .feedback-mid{color:var(--warn);font-weight:700}
    .feedback-bad{color:var(--danger);font-weight:700}

    /* FAB */
    .fab{
      position:fixed; right:18px; bottom:18px; z-index:1300; width:var(--fab-size); height:var(--fab-size);
      border-radius:999px; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,var(--primary),#3f74d8);
      color:white; box-shadow: 0 12px 30px rgba(91,141,239,0.24); text-decoration:none; font-size:20px;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .fab:hover{ transform: translateY(-6px); box-shadow: 0 20px 40px rgba(91,141,239,0.28) }
    .fab:active{ transform: translateY(-2px) }

    /* responsive */
    @media (max-width:720px){
      .wrap{padding:12px}
      .acc-head{padding:10px}
      .acc-body.show{padding:12px}
      .card{padding:12px}
      .modal{
        padding:16px;
        max-width:100%;
        max-height:95vh;
        border-radius:12px;
      }
      .modal-header{
        padding-bottom:10px;
      }
      .score-pill{
        font-size:1.15rem;
        padding:6px 12px;
      }
      .score-message{
        font-size:1rem;
      }
      header{flex-direction:column;align-items:flex-start;gap:8px}
      .modal-header > div:first-child{
        flex-direction:column;
        align-items:flex-start !important;
        gap:10px !important;
      }
      .modal-header h2{
        font-size:1.3rem;
      }
      .section-line{
        font-size:0.9rem;
      }
    }
    
    @media (max-width:480px){
      .modal{
        padding:14px;
        max-height:96vh;
      }
      .score-box{
        flex-direction:column;
        align-items:flex-start;
        gap:10px;
      }
    }

    /* Toast notification */
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:20px;
      background:linear-gradient(90deg,var(--primary),#3f74d8);
      color:white;
      padding:12px 16px;
      border-radius:10px;
      box-shadow:0 10px 30px rgba(91,141,239,0.25);
      z-index:1400;
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp{
      from{opacity:0;transform:translateX(-50%) translateY(20px)}
      to{opacity:1;transform:translateX(-50%) translateY(0)}
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- header -->
    <header class="site">
      <div class="title">
        <h1>Social Media Awareness Assessment</h1>
        <p>Test your understanding of online safety, responsible posting, and digital citizenship.</p>
      </div>
      <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
        <div class="badge">KS3 â€¢ Year 7</div>
        <button class="btn ghost" id="helpToggle" title="Toggle instructions"><i data-feather="info"></i> Instructions</button>
      </div>
    </header>

    <!-- instructions card (collapsed by default) -->
    <section class="card" id="instructionsCard" style="display:none">
      <div class="instructions">
        <div style="min-width:54px; height:54px; border-radius:12px; background:linear-gradient(180deg,var(--primary-100),#eef7ff); display:flex; align-items:center; justify-content:center">
          <i data-feather="book" style="color:var(--primary)"></i>
        </div>
        <div style="flex:1">
          <h3 style="margin:0 0 8px 0;color:var(--primary)">Before you begin</h3>
          <div class="muted">Read each section carefully. Matching, multiple-choice, fill-ins and diagram are auto-marked. Short written answers will be visible to your teacher. Click Submit to see your results in a popup.</div>
          <div style="margin-top:10px;" class="row">
            <input id="studentName" placeholder="Your full name (optional)" style="flex:1;min-width:160px;padding:10px;border-radius:10px;border:1px solid rgba(14,47,99,0.06)" />
            <input id="studentClass" placeholder="Class (e.g. 7B)" style="width:120px;padding:10px;border-radius:10px;border:1px solid rgba(14,47,99,0.06)" />
          </div>
        </div>
      </div>
    </section>

    <!-- accordion wrapper -->
    <div class="accordion">

      <!-- Section A: Awareness (MCQ) -->
      <div class="acc-item">
        <div class="acc-head" data-target="a-body">
          <div>
            <h3>Section A â€” Social Media Awareness (Multiple Choice)</h3>
            <div class="meta">2 auto-marked multiple-choice questions</div>
          </div>
          <i data-feather="chevron-down" class="toggle-icon"></i>
        </div>
        <div class="acc-body" id="a-body">
          <div class="question">
            <div class="q-title">1. Which of these is the strongest (safest) password?</div>
            <div class="choices">
              <label><input name="m1" type="radio" value="a"> A) MyName123</label>
              <label><input name="m1" type="radio" value="b"> B) P@ssw0rd!</label>
              <label><input name="m1" type="radio" value="c"> C) C@t#91$gH</label>
              <label><input name="m1" type="radio" value="d"> D) 123456</label>
            </div>
          </div>

          <div class="question">
            <div class="q-title">2. Which is an example of personal information you should NOT share publicly?</div>
            <div class="choices">
              <label><input name="m2" type="radio" value="a"> A) Favourite colour</label>
              <label><input name="m2" type="radio" value="b"> B) Home address</label>
              <label><input name="m2" type="radio" value="c"> C) Favourite TV show</label>
              <label><input name="m2" type="radio" value="d"> D) Pet's name</label>
            </div>
          </div>
        </div>
      </div>

      <!-- Section B: Safe Practices (True/False) -->
      <div class="acc-item">
        <div class="acc-head" data-target="b-body">
          <div>
            <h3>Section B â€” Safe Practices (True / False)</h3>
            <div class="meta">3 quick true/false items</div>
          </div>
          <i data-feather="chevron-down" class="toggle-icon"></i>
        </div>
        <div class="acc-body" id="b-body">
          <div class="question">
            <div class="q-title">1. It's OK to share a classmate's photo online if they don't mind.</div>
            <div class="choices">
              <label><input name="t1" type="radio" value="true"> True</label>
              <label><input name="t1" type="radio" value="false"> False</label>
            </div>
          </div>

          <div class="question">
            <div class="q-title">2. A private account makes your information completely safe.</div>
            <div class="choices">
              <label><input name="t2" type="radio" value="true"> True</label>
              <label><input name="t2" type="radio" value="false"> False</label>
            </div>
          </div>

          <div class="question">
            <div class="q-title">3. Reporting a harmful post is the right action.</div>
            <div class="choices">
              <label><input name="t3" type="radio" value="true"> True</label>
              <label><input name="t3" type="radio" value="false"> False</label>
            </div>
          </div>
        </div>
      </div>

      <!-- Section C: Online Behaviour (Fill in the Blank) -->
      <div class="acc-item">
        <div class="acc-head" data-target="c-body">
          <div>
            <h3>Section C â€” Online Behaviour (Fill in the Blank)</h3>
            <div class="meta">3 fill-in answers</div>
          </div>
          <i data-feather="chevron-down" class="toggle-icon"></i>
        </div>
        <div class="acc-body" id="c-body">
          <div class="question">
            <div class="q-title">1. Always think before you <input id="fb1" placeholder="_____" style="width:140px; display:inline-block" />.</div>
          </div>

          <div class="question">
            <div class="q-title">2. If someone is being bullied online, you should <input id="fb2" placeholder="_____" style="width:160px; display:inline-block" /> it.</div>
          </div>

          <div class="question">
            <div class="q-title">3. The term for a scam that tricks you into giving information is called <input id="fb3" placeholder="_____" style="width:150px; display:inline-block" />.</div>
          </div>
        </div>
      </div>

      <!-- Section D: Reflection (Short Text) -->
      <div class="acc-item">
        <div class="acc-head" data-target="d-body">
          <div>
            <h3>Section D â€” Reflection (Short Text)</h3>
            <div class="meta">2 short written answers (teacher review)</div>
          </div>
          <i data-feather="chevron-down" class="toggle-icon"></i>
        </div>
        <div class="acc-body" id="d-body">
          <div class="question">
            <div class="q-title">1. What can you do to make social media a more positive space?</div>
            <textarea id="sa1" placeholder="1â€“3 sentences"></textarea>
          </div>

          <div class="question">
            <div class="q-title">2. How do you know when it's better not to comment on a post?</div>
            <textarea id="sa2" placeholder="1â€“2 sentences"></textarea>
          </div>
        </div>
      </div>

    </div> <!-- accordion -->

    <!-- Submit area -->
    <section class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="submitBtn" class="btn green"><i data-feather="check"></i> Submit Assessment</button>
          <button id="clearBtn" class="btn red"><i data-feather="trash-2"></i> Clear Saved</button>
          <button id="printBtn" class="btn blue"><i data-feather="printer"></i> Print Results</button>
        </div>
        <div class="muted">Auto-marked: MCQ, True/False, Fill-ins</div>
      </div>
    </section>

    <footer style="text-align:center;margin-top:12px;color:var(--muted)">Â© 2025 Computer Science @ SVS</footer>
  </div>

  <!-- Floating FAB -->
  <a class="fab" href="phishing-detective.html" target="_blank" rel="noopener noreferrer" title="Play Phishing Detective ðŸ•µï¸â€â™‚ï¸">ðŸŽ®</a>

  <!-- Modal: results -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      
      <div class="modal-header">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:200px">
            <h2 id="modalTitle" style="margin:0">Your Results</h2>
            <div id="modalSub" class="muted" style="margin-top:4px;font-size:0.85rem"></div>
          </div>
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <button id="modalClose" class="btn ghost" style="padding:8px 12px"><i data-feather="x"></i> Close</button>
            <button id="modalRetry" class="btn" style="padding:8px 12px">Retry</button>
          </div>
        </div>
      </div>

      <div class="modal-content">
        <div class="score-box" style="margin-top:8px">
          <div class="score-pill" id="overallScore">--</div>
          <div style="flex:1">
            <div class="score-message" id="scoreMessage">â€”</div>
            <div class="muted" id="scoreMeta" style="margin-top:4px;font-size:0.85rem"></div>
          </div>
        </div>

        <div class="section-breakdown" id="sectionBreakdown" style="margin-top:14px"></div>

        <div style="margin-top:14px">
          <h4 style="margin:0 0 8px 0;font-size:1rem">Auto-marked question breakdown</h4>
          <div id="autoBreakdown" class="muted" style="font-size:0.9rem"></div>
        </div>

        <div style="margin-top:14px">
          <h4 style="margin:0 0 8px 0;font-size:1rem">Your written answers (for teacher)</h4>
          <div id="writtenFB" style="background:#fbfdff;padding:10px;border-radius:8px;border:1px solid rgba(91,141,239,0.04);font-size:0.9rem"></div>
        </div>
      </div>
      
    </div>
  </div>

  <script>
    // Initialize feather icons
    feather.replace();

    /***** Utilities *****/
    const norm = s => (s||'').toString().trim().toLowerCase();

    /***** FIX 1: Accordion behaviour - NOW WORKING *****/
    document.querySelectorAll('.acc-head').forEach(head => {
      head.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const body = document.getElementById(targetId);
        const isOpen = body.classList.contains('show');
        
        // Toggle this section
        if (isOpen) {
          body.classList.remove('show');
          this.classList.remove('active');
        } else {
          body.classList.add('show');
          this.classList.add('active');
        }
        
        // Re-render feather icons
        feather.replace();
      });
    });

    /***** FIX 2: Help toggle - NOW WORKING *****/
    document.getElementById('helpToggle').addEventListener('click', function() {
      const card = document.getElementById('instructionsCard');
      const isVisible = card.style.display !== 'none';
      card.style.display = isVisible ? 'none' : 'block';
      feather.replace();
    });

    /***** Correct answers *****/
    const mcqAnswers = { m1: 'c', m2: 'b' };
    const tfAnswers = { t1: 'false', t2: 'false', t3: 'true' };
    const fillAnswers = {
      fb1: ['post','posting','post.','post!'],
      fb2: ['report','tell an adult','tell someone','report it'],
      fb3: ['phishing','phishing scam','phishing.','phishing scam.']
    };

    function checkFill(id, val) {
      const v = norm(val);
      if(!fillAnswers[id]) return false;
      return fillAnswers[id].some(ans => norm(ans) === v);
    }

    /***** FIX 3: Submit button - NOW WORKING *****/
    document.getElementById('submitBtn').addEventListener('click', function() {
      // MCQs
      let mcqTotal = Object.keys(mcqAnswers).length, mcqCorrect = 0;
      const mcqDetails = [];
      for(const q in mcqAnswers){
        const sel = document.querySelector('input[name="'+q+'"]:checked');
        const chosen = sel ? sel.value : null;
        const ok = chosen === mcqAnswers[q];
        if(ok) mcqCorrect++;
        mcqDetails.push({q,chosen,ok});
      }

      // True/False
      let tfTotal = Object.keys(tfAnswers).length, tfCorrect = 0;
      const tfDetails = [];
      for(const q in tfAnswers){
        const sel = document.querySelector('input[name="'+q+'"]:checked');
        const chosen = sel ? sel.value : null;
        const ok = chosen === tfAnswers[q];
        if(ok) tfCorrect++;
        tfDetails.push({q,chosen,ok});
      }

      // Fill-ins
      let fillTotal = 3, fillCorrect = 0;
      const fillDetails = [];
      for(let i=1;i<=3;i++){
        const id = 'fb'+i;
        const val = (document.getElementById(id).value||'').trim();
        const ok = checkFill(id,val);
        if(ok) fillCorrect++;
        fillDetails.push({id,answer:val,ok});
      }

      // Written answers
      const wa1 = (document.getElementById('sa1').value||'').trim();
      const wa2 = (document.getElementById('sa2').value||'').trim();

      // Totals
      const autoCorrect = mcqCorrect + tfCorrect + fillCorrect;
      const autoTotal = mcqTotal + tfTotal + fillTotal;

      const now = new Date().toLocaleString();
      const results = {
        date: now,
        name: document.getElementById('studentName').value || '',
        class: document.getElementById('studentClass').value || '',
        mcqTotal, mcqCorrect, mcqDetails,
        tfTotal, tfCorrect, tfDetails,
        fillTotal, fillCorrect, fillDetails,
        autoTotal, autoCorrect,
        wa1, wa2
      };

      // localStorage
      let saved = null;
      try { saved = JSON.parse(localStorage.getItem('socialMediaResults')); } catch(e){}
      if(!saved) saved = {bestScore:0,attempts:0,bestDate:null};
      saved.attempts = (saved.attempts || 0) + 1;
      if(autoCorrect > (saved.bestScore || 0)) { 
        saved.bestScore = autoCorrect; 
        saved.bestDate = now; 
      }
      const store = {meta:saved, last:results};
      localStorage.setItem('socialMediaResults', JSON.stringify(store));

      // Show results
      showResults(store);
    });

    function showResults(store){
      const out = store.last;

      // Overall score
      document.getElementById('overallScore').textContent = `${out.autoCorrect}/${out.autoTotal}`;

      // Message
      const pct = Math.round((out.autoCorrect / out.autoTotal) * 100);
      let msg = 'Keep learning!';
      if(pct >= 85) msg = 'Excellent work!';
      else if(pct >= 65) msg = 'Good job â€” keep improving.';
      else if(pct >= 45) msg = 'You need a bit more practice.';
      document.getElementById('scoreMessage').textContent = msg;
      document.getElementById('scoreMeta').textContent = `Auto-marked â€¢ Best: ${store.meta.bestScore}/${out.autoTotal} (${store.meta.bestDate || 'â€”'}) â€¢ Attempts: ${store.meta.attempts}`;

      // Section breakdown
      const sectionBreakdown = document.getElementById('sectionBreakdown');
      sectionBreakdown.innerHTML = '';
      sectionBreakdown.appendChild(makeSectionLine('Section A â€” Awareness (MCQ)', out.mcqCorrect, out.mcqTotal));
      sectionBreakdown.appendChild(makeSectionLine('Section B â€” Safe Practices (T/F)', out.tfCorrect, out.tfTotal));
      sectionBreakdown.appendChild(makeSectionLine('Section C â€” Online Behaviour (Fill-ins)', out.fillCorrect, out.fillTotal));

      // Auto-marked breakdown
      const autoBreak = document.getElementById('autoBreakdown');
      autoBreak.innerHTML = '';

      // MCQ details
      let mcqHTML = '<div><strong>Multiple choice:</strong><ul style="margin-top:6px">';
      out.mcqDetails.forEach((d,i)=>{
        mcqHTML += `<li style="margin-top:4px">Q${i+1}: ${d.ok ? '<span style="color:var(--success)">âœ“ Correct</span>' : '<span style="color:var(--danger)">âœ— Wrong</span>'} â€” Answer: ${d.chosen || '<em>none</em>'}</li>`;
      });
      mcqHTML += '</ul></div>';
      autoBreak.innerHTML += mcqHTML;

      // True/False details
      let tfHTML = '<div style="margin-top:10px"><strong>True / False:</strong><ul style="margin-top:6px">';
      out.tfDetails.forEach((d,i)=>{
        tfHTML += `<li style="margin-top:4px">Item ${i+1}: ${d.ok ? '<span style="color:var(--success)">âœ“ Correct</span>' : '<span style="color:var(--danger)">âœ— Wrong</span>'} â€” Answer: ${d.chosen || '<em>none</em>'}</li>`;
      });
      tfHTML += '</ul></div>';
      autoBreak.innerHTML += tfHTML;

      // Fill-in details
      let fillHTML = '<div style="margin-top:10px"><strong>Fill-ins:</strong><ul style="margin-top:6px">';
      out.fillDetails.forEach((f,i)=>{
        fillHTML += `<li style="margin-top:4px">F${i+1}: ${f.ok ? '<span style="color:var(--success)">âœ“ Correct</span>' : '<span style="color:var(--danger)">âœ— Wrong</span>'} â€” "${f.answer||'<em>none</em>'}"</li>`;
      });
      fillHTML += '</ul></div>';
      autoBreak.innerHTML += fillHTML;

      // Written answers
      document.getElementById('writtenFB').innerHTML = `<div><strong>1.</strong> ${out.wa1 || '<em>none</em>'}</div><div style="margin-top:8px"><strong>2.</strong> ${out.wa2 || '<em>none</em>'}</div>`;

      // Modal metadata
      document.getElementById('modalSub').textContent = `${out.name ? out.name + (out.class ? ' â€¢ ' + out.class : '') : ''} ${out.date ? ' â€¢ ' + out.date : ''}`.trim();

      // Show modal
      openModal();
    }

    function makeSectionLine(label, correct, total){
      const div = document.createElement('div');
      div.className = 'section-line';
      const pct = total ? Math.round((correct/total)*100) : 0;
      let cls = 'feedback-bad';
      if(pct >= 85) cls = 'feedback-good';
      else if(pct >= 65) cls = 'feedback-mid';

      div.innerHTML = `<div style="display:flex;flex-direction:column"><div class="label">${label}</div><div class="small">${correct} / ${total} (${pct}%)</div></div><div class="${cls}">${pct}%</div>`;
      return div;
    }

    /***** Modal functions *****/
    function openModal(){
      document.getElementById('modalBackdrop').classList.add('show');
      document.body.style.overflow = 'hidden';
      feather.replace();
    }
    
    function closeModal(){
      document.getElementById('modalBackdrop').classList.remove('show');
      document.body.style.overflow = '';
    }

    document.getElementById('modalClose').addEventListener('click', closeModal);
    
    document.getElementById('modalRetry').addEventListener('click', function() {
      closeModal();
      // Clear auto-marked answers
      document.querySelectorAll('input[type="radio"]').forEach(r=> r.checked = false);
      for(let i=1;i<=3;i++) document.getElementById('fb'+i).value = '';
      // Scroll to first section
      document.querySelector('.acc-item').scrollIntoView({behavior:'smooth', block:'center'});
      showToast('Auto-marked answers cleared. Ready to retry!');
    });

    // Close on backdrop click
    document.getElementById('modalBackdrop').addEventListener('click', function(e) {
      if(e.target === this) closeModal();
    });

    // Close on ESC
    document.addEventListener('keydown', function(e) {
      if(e.key === 'Escape') closeModal();
    });

    /***** FIX 4: Clear button - NOW WORKING *****/
    document.getElementById('clearBtn').addEventListener('click', function() {
      if(confirm('Are you sure you want to clear all saved results?')) {
        localStorage.removeItem('socialMediaResults');
        showToast('âœ“ All saved results cleared!');
      }
    });

    /***** FIX 5: Print button - NOW WORKING *****/
    document.getElementById('printBtn').addEventListener('click', function() {
      const raw = localStorage.getItem('socialMediaResults');
      if(raw){
        try {
          const store = JSON.parse(raw);
          if(store.last) {
            showResults(store);
            setTimeout(function() {
              window.print();
            }, 500);
          } else {
            showToast('âš  No results to print. Submit the assessment first!');
          }
        } catch(e){
          showToast('âš  No results to print. Submit the assessment first!');
        }
      } else {
        showToast('âš  No results to print. Submit the assessment first!');
      }
    });

    /***** Toast notification *****/
    function showToast(msg, ms=2800){
      const t = document.createElement('div');
      t.className = 'toast';
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(function() {
        t.remove();
      }, ms);
    }

    // Load saved results on page load (don't auto-show modal)
    window.addEventListener('DOMContentLoaded', function() {
      feather.replace();
    });
  </script>
</body>

</html>
